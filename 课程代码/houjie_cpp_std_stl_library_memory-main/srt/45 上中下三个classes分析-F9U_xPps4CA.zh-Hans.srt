1
00:00:05,632 --> 00:00:09,472
好现在我们进入内存管理这门课程的视角

2
00:00:09,984 --> 00:00:12,032
我要谈的是楼梯

3
00:00:13,312 --> 00:00:15,104
这个产品的Hello Kitty

4
00:00:15,360 --> 00:00:16,896
Roasted locator

5
00:00:19,968 --> 00:00:20,992
现在进行

6
00:00:22,016 --> 00:00:26,368
这个层次我们应该已经成竹在胸了

7
00:00:26,880 --> 00:00:29,696
我们已经看过标准库的分配器

8
00:00:30,208 --> 00:00:33,536
也下探到非常底层的malloc

9
00:00:34,048 --> 00:00:35,072
10座

10
00:00:35,840 --> 00:00:39,936
所以接下来要学习任何的内存管理的机制

11
00:00:40,448 --> 00:00:41,216
手段

12
00:00:41,728 --> 00:00:43,520
应该都非常的轻松了

13
00:00:43,776 --> 00:00:45,824
因为70内存管理

14
00:00:46,080 --> 00:00:47,616
他有一个共性

15
00:00:49,408 --> 00:00:50,176
好

16
00:00:50,688 --> 00:00:56,320
OK当然往下学习很轻松的话我刚刚说应该是要很轻松了

17
00:00:56,832 --> 00:00:58,624
一个前提就是你

18
00:00:59,392 --> 00:01:01,184
在前面的几讲里面

19
00:01:01,440 --> 00:01:02,720
你确实曾经

20
00:01:02,976 --> 00:01:05,536
花下大量的时间去思考

21
00:01:07,328 --> 00:01:11,936
去整理出他们个个技巧的共性跟他的差异性

22
00:01:12,192 --> 00:01:15,520
也能够判断出哪一种手段是好的

23
00:01:15,776 --> 00:01:18,080
哪一种手段是不太高明了

24
00:01:22,688 --> 00:01:24,480
现在主要谈的这一个

25
00:01:24,736 --> 00:01:25,760
分配器

26
00:01:26,016 --> 00:01:26,528
是

27
00:01:26,784 --> 00:01:30,112
LG这个library的头的一部分

28
00:01:31,392 --> 00:01:36,256
这个字怎么发音我也不是很确定oki

29
00:01:36,768 --> 00:01:41,376
看字面的意思从英文的发音的就把那层楼

30
00:01:43,424 --> 00:01:47,264
我上网去查了一下这个还被翻译成若机

31
00:01:47,520 --> 00:01:53,664
在洛基就是那个电影里面很有名的那个洛奇全集的那个那个我自己

32
00:01:53,920 --> 00:02:00,064
之前也没有去注意他的那部电影的英文名字是不是那个就是那我也不

33
00:02:00,320 --> 00:02:01,600
确定确定

34
00:02:01,856 --> 00:02:06,976
我们经常讲的电影就讲洛基的父亲一起把第几集

35
00:02:07,232 --> 00:02:10,048
好这个楼梯这个Library

36
00:02:10,304 --> 00:02:16,448
是一个在业界非常有名的很前沿的技术上可以前演的一个库

37
00:02:17,728 --> 00:02:20,544
但是他并不是很成熟

38
00:02:21,056 --> 00:02:22,848
我这样讲的意思是

39
00:02:23,360 --> 00:02:29,504
作者本身对于这个版本的维护就只到最新直到0.1

40
00:02:29,760 --> 00:02:31,040
1.78

41
00:02:31,808 --> 00:02:37,952
一般来讲软件是1.0还是一个正式的推出版本这是零而且是零的

42
00:02:38,208 --> 00:02:38,720
1.1

43
00:02:39,488 --> 00:02:43,584
而且能自如果上去看的话就会看到他的

44
00:02:43,840 --> 00:02:45,632
已经不太维护了

45
00:02:46,656 --> 00:02:49,984
这个作者是新佳佳标准

46
00:02:50,240 --> 00:02:53,056
委员会里头一个很重要的成员

47
00:02:53,568 --> 00:02:57,152
他写了这么一本书叫mortenson家DIY

48
00:02:58,432 --> 00:03:00,480
这个很明显这个作者他

49
00:03:00,992 --> 00:03:02,272
这个这个

50
00:03:03,296 --> 00:03:09,440
这个发音我也不敢见啊不会念他只是哪一国人的欧洲的不知道哪一国人

51
00:03:09,952 --> 00:03:10,720
好

52
00:03:10,976 --> 00:03:14,560
他写出这个书就是要来解释

53
00:03:14,816 --> 00:03:16,864
Lotus and Library

54
00:03:17,632 --> 00:03:23,776
那这个整个library不是为内存管理而设计的它有它另外宏大的目标这个

55
00:03:24,032 --> 00:03:26,592
这个我们就不提了跟设计模式有关

56
00:03:27,616 --> 00:03:29,920
不过在这个里头他会的支持

57
00:03:30,176 --> 00:03:31,456
内存的分配

58
00:03:32,224 --> 00:03:35,296
所以他写了一个单独的

59
00:03:35,552 --> 00:03:39,392
独立出来的一个小小小酷小系统

60
00:03:40,160 --> 00:03:41,696
我们现在要学习的就是他

61
00:03:43,232 --> 00:03:49,376
这个系统为什么我挑出来作为第4家来谈谈因为他非常的金钱我就他

62
00:03:49,632 --> 00:03:50,144
放

63
00:03:50,656 --> 00:03:56,288
而且拿它来跟标准库的分配器文的第2讲谈到的跟这个来比呢

64
00:03:56,544 --> 00:04:00,128
又有比起标准库的一个非常明显的好处

65
00:04:00,896 --> 00:04:05,248
当我在讲标准库的分配器时候我谈的是个木的那一个

66
00:04:05,760 --> 00:04:09,600
其他微cbc的那些我们已经看过了不值一提

67
00:04:09,856 --> 00:04:11,392
里头根本什么都没做

68
00:04:12,416 --> 00:04:13,440
换那个

69
00:04:14,208 --> 00:04:16,512
那个样貌就调用没落高而已

70
00:04:16,768 --> 00:04:18,303
好

71
00:04:19,071 --> 00:04:23,679
那么石墨烯的新标准库里面的分配器他

72
00:04:23,935 --> 00:04:25,983
致命伤是什么

73
00:04:26,495 --> 00:04:30,335
就是他很棒到我们在第二章已经讲的很清楚了

74
00:04:30,591 --> 00:04:32,383
他是不还给操作系统

75
00:04:32,895 --> 00:04:34,687
全部都掌握在他的手中

76
00:04:35,455 --> 00:04:37,503
所以这可能会影响其他的

77
00:04:37,759 --> 00:04:39,551
Products其他的进程

78
00:04:39,807 --> 00:04:42,623
运作在多任务的环境下

79
00:04:43,391 --> 00:04:44,927
但是这一个楼梯

80
00:04:45,951 --> 00:04:46,975
他可以换

81
00:04:48,767 --> 00:04:49,791
好好学习下去

82
00:04:50,047 --> 00:04:55,679
我也试图在网络上了去找这一个漏气的官网

83
00:04:56,191 --> 00:04:56,959
以前

84
00:04:57,215 --> 00:04:57,983
能够找到

85
00:04:58,495 --> 00:05:03,615
那现在呢找不到了不知道是我用的搜寻引擎不够厉害还是怎么样

86
00:05:03,871 --> 00:05:04,639
找不到

87
00:05:05,919 --> 00:05:07,455
我在

88
00:05:07,967 --> 00:05:14,111
制作这个拖影片的时候我是只能够去找到在这个周末呢

89
00:05:14,623 --> 00:05:15,903
这个网站上面

90
00:05:16,671 --> 00:05:18,975
能够去下载它的源代码

91
00:05:19,487 --> 00:05:21,279
这是你现在看到的这个画面

92
00:05:22,559 --> 00:05:24,607
那你下载这个源代码之后

93
00:05:24,863 --> 00:05:27,935
有十来个文件我记得

94
00:05:28,191 --> 00:05:34,335
迟来的文件其中有我记得有两个文件其实你下载之后你看这个文

95
00:05:34,591 --> 00:05:40,735
文件的名称你就知道了好像是叫做small of Jazz内的小区块小度

96
00:05:40,991 --> 00:05:44,063
对象去会这样你就知道是

97
00:05:44,319 --> 00:05:47,647
非常的独立把那两个抽取出来

98
00:05:48,415 --> 00:05:48,927
WhatsApp

99
00:05:49,183 --> 00:05:54,815
待会呢我也会带你去看他的源代码比对一下确认你抽取出来的那两个是

100
00:05:55,071 --> 00:05:55,839
是正确的

101
00:05:56,607 --> 00:05:59,679
他们就可以独立独立的拿来运用

102
00:06:01,215 --> 00:06:03,007
好这个是看到楼梯

103
00:06:04,543 --> 00:06:05,823
洛基

104
00:06:06,591 --> 00:06:07,871
我这个名字啊

105
00:06:08,383 --> 00:06:12,223
据说网络上查到了是起源于北欧的神话

106
00:06:12,735 --> 00:06:16,831
这个神话西方的神话有希腊神话罗马神话

107
00:06:17,087 --> 00:06:20,159
阿神的名字不太一样太阳神的名字不一样

108
00:06:20,671 --> 00:06:24,255
好的西欧的神话里面的楼梯

109
00:06:24,511 --> 00:06:26,559
据说是一个暴力的神

110
00:06:27,071 --> 00:06:32,447
奥莉比较暗黑的暴力的是

111
00:06:32,959 --> 00:06:34,495
我们后面会看到

112
00:06:35,519 --> 00:06:39,615
这位作者在写这个代码的时候也非常的暴力

113
00:06:40,127 --> 00:06:46,015
不知道是不是因为这样啊给他的灵感他就显露其作为民生

114
00:06:46,527 --> 00:06:47,551
好不管他了

115
00:06:47,807 --> 00:06:50,111
Nokia locator

116
00:06:50,623 --> 00:06:56,767
在你刚刚我说你下载的量应该是两个文件一个点一个点c p

117
00:06:57,279 --> 00:07:01,119
印象是这样的头那你就可以看到三个Plus

118
00:07:03,935 --> 00:07:05,983
从最低一阶到最高阶

119
00:07:06,239 --> 00:07:07,007
Chunk

120
00:07:07,775 --> 00:07:11,359
Which are located in small Object allocator

121
00:07:11,871 --> 00:07:14,943
我们使用者面对的是这一个

122
00:07:17,759 --> 00:07:20,319
好了那下面是他的背后的支撑

123
00:07:21,855 --> 00:07:25,183
我们现在来分析它因为等一下看它的源代码

124
00:07:25,951 --> 00:07:26,719
Trunk

125
00:07:27,231 --> 00:07:28,767
这里有3笔数据

126
00:07:29,535 --> 00:07:31,583
我把它画成图就是左边这样

127
00:07:32,607 --> 00:07:34,399
第1个是一个自尊

128
00:07:34,655 --> 00:07:36,703
指向unsigned character

129
00:07:37,471 --> 00:07:40,799
Unsecured就是一个byte一个字节

130
00:07:41,567 --> 00:07:44,383
他将来就是会这么使用

131
00:07:45,663 --> 00:07:47,455
他会去分配一块

132
00:07:47,967 --> 00:07:50,015
比较唱可比较大的一块

133
00:07:53,343 --> 00:07:54,367
那么

134
00:07:54,879 --> 00:08:01,023
后面这两个变量是什么那一个叫first available block的一个可用区块的

135
00:08:01,279 --> 00:08:02,047
在哪里

136
00:08:02,559 --> 00:08:05,375
想必你可以想象这个大概是被切的

137
00:08:05,631 --> 00:08:08,447
像先前我们谈到了

138
00:08:08,703 --> 00:08:09,727
把他气切

139
00:08:09,983 --> 00:08:15,615
变成一个链表然后用千是个指针串起来

140
00:08:16,639 --> 00:08:20,479
没错这就是共性所有的分配器都会这样做

141
00:08:21,759 --> 00:08:25,343
但是这里很独特他不是使用指针

142
00:08:26,111 --> 00:08:28,671
非常独特的做法这个后面再说了

143
00:08:28,927 --> 00:08:34,559
说这边这个指针的就是指的这一整块儿这个这个是一个index索引

144
00:08:35,327 --> 00:08:39,935
它就是指向到底现在接下来要供应的那一块是一几号

145
00:08:40,191 --> 00:08:43,007
17号还是的27号还是怎么样

146
00:08:45,823 --> 00:08:46,847
下面这一个呢

147
00:08:47,359 --> 00:08:48,639
Proxifier

148
00:08:48,895 --> 00:08:51,967
目前还可以供应几个区块

149
00:08:52,223 --> 00:08:57,087
这比如说这个地方被切成64块上目前剩下60块

150
00:08:58,623 --> 00:09:02,463
而接下去要给的那块在哪里能在B次号的位置上面

151
00:09:03,231 --> 00:09:05,023
这个土地一直就是这样

152
00:09:08,607 --> 00:09:09,887
这是最底层的

153
00:09:10,143 --> 00:09:11,679
在网上

154
00:09:11,935 --> 00:09:15,007
中间是一个class accelerator

155
00:09:15,263 --> 00:09:18,079
它里面的数据有什么那华盛顿

156
00:09:18,847 --> 00:09:19,615
华盛顿

157
00:09:20,383 --> 00:09:22,175
它里头有一种best

158
00:09:22,943 --> 00:09:24,991
里面放着很多的枪

159
00:09:25,503 --> 00:09:28,063
这里的抢购是指这个数据结构

160
00:09:28,575 --> 00:09:29,343
就是下面这个

161
00:09:31,135 --> 00:09:33,951
所以我画成这样子

162
00:09:34,463 --> 00:09:38,559
Zachary头可以有多少个很多个恩哥吗是我真甜甜点

163
00:09:40,095 --> 00:09:42,655
另外还有两根指针

164
00:09:43,679 --> 00:09:47,263
指向什么能指向强的指向下面这种东西

165
00:09:48,287 --> 00:09:49,567
所以你可以想象

166
00:09:49,823 --> 00:09:51,871
中间阶层啊

167
00:09:53,151 --> 00:09:59,295
就是很多的这一种绿色的这一款很多的这种东西而这两根指针会

168
00:09:59,551 --> 00:10:02,623
指向其中的某两个

169
00:10:05,695 --> 00:10:07,231
好我们在网上看

170
00:10:07,743 --> 00:10:08,767
最高层

171
00:10:09,535 --> 00:10:11,839
这里头也有一个Master

172
00:10:12,095 --> 00:10:15,167
里面放的是中间这种东西

173
00:10:16,447 --> 00:10:19,263
只有把它化成图现在我行这话

174
00:10:19,775 --> 00:10:21,055
很多个

175
00:10:21,311 --> 00:10:22,591
天天点很多个

176
00:10:24,127 --> 00:10:26,687
而这里头另外还有两根指针

177
00:10:27,455 --> 00:10:28,223
至此项

178
00:10:28,735 --> 00:10:30,271
指向中间这种东西

179
00:10:30,527 --> 00:10:31,551
水化成镇

180
00:10:32,063 --> 00:10:33,087
这两根指针

181
00:10:33,343 --> 00:10:35,647
指向这里头的头两个

182
00:10:37,183 --> 00:10:41,535
而这里头的指针指的是下面这一串的猫娘的

183
00:10:42,559 --> 00:10:45,119
想必这个某两个人

184
00:10:45,375 --> 00:10:46,911
特殊的用途

185
00:10:48,191 --> 00:10:49,471
可能只要协助

186
00:10:49,727 --> 00:10:51,775
效率更快换什么灯能等

187
00:10:53,055 --> 00:10:55,359
这是这23个class

188
00:10:56,127 --> 00:10:57,407
的结构
