1
00:00:06,144 --> 00:00:08,704
我们现在开始来看看怎么样在

2
00:00:08,960 --> 00:00:10,752
手上的婴儿歌

3
00:00:11,008 --> 00:00:12,288
最开始是因为那个

4
00:00:14,336 --> 00:00:16,640
中切出一块出来

5
00:00:16,896 --> 00:00:23,040
这一块我们的故事从这里开始的io init1他发出了第一次需求

6
00:00:23,552 --> 00:00:28,672
一直跑跑跑跑到现在我们要分析的这个最后的这个函数

7
00:00:30,976 --> 00:00:32,256
这时候手上

8
00:00:32,768 --> 00:00:37,888
Sdh的整个就是他手上已经有那个那个

9
00:00:39,936 --> 00:00:41,216
我怎么管理呢

10
00:00:42,496 --> 00:00:43,776
下面这个东西

11
00:00:44,288 --> 00:00:46,592
进入这个函数了

12
00:00:48,384 --> 00:00:49,920
刚刚的这个

13
00:00:50,944 --> 00:00:52,480
32 group

14
00:00:55,040 --> 00:00:55,552
在

15
00:00:55,808 --> 00:01:00,160
Sch设计上就是希望用这32个部落

16
00:01:00,672 --> 00:01:03,232
去对应右边

17
00:01:04,256 --> 00:01:06,816
逻辑上把他小朋友32块

18
00:01:08,096 --> 00:01:11,936
就把这一每个在弄小一点再小一点

19
00:01:12,704 --> 00:01:13,728
因此

20
00:01:13,984 --> 00:01:16,032
Omega-3 32

21
00:01:16,544 --> 00:01:19,872
这边32个单元每个单元是多少

22
00:01:21,664 --> 00:01:23,200
1024除以32

23
00:01:27,040 --> 00:01:28,320
所有看这个图

24
00:01:29,600 --> 00:01:30,880
这一块

25
00:01:31,904 --> 00:01:36,000
就分成36个单元了你仔细数一数32个

26
00:01:38,816 --> 00:01:42,656
这一块将会由它来管理

27
00:01:42,912 --> 00:01:43,936
他是什么

28
00:01:44,192 --> 00:01:45,472
他就是64

29
00:01:45,728 --> 00:01:46,752
对称

30
00:01:47,776 --> 00:01:50,336
也就是64个是由链表

31
00:01:55,200 --> 00:01:58,016
这每一块除了

32
00:01:58,272 --> 00:02:02,624
1024 slash 1/32会是32k

33
00:02:03,904 --> 00:02:09,024
这32k的又再把他更细分的边分为八大会

34
00:02:10,816 --> 00:02:12,608
那么一会就是4K

35
00:02:13,120 --> 00:02:15,424
12345678

36
00:02:15,680 --> 00:02:16,704
84 32

37
00:02:17,216 --> 00:02:17,728
所以

38
00:02:17,984 --> 00:02:19,008
画了这张图

39
00:02:19,520 --> 00:02:21,568
这一个就是这个

40
00:02:21,824 --> 00:02:25,408
这一个展开来就是这个

41
00:02:26,432 --> 00:02:29,760
另外还有其他的多少个呢

42
00:02:31,040 --> 00:02:34,880
八大会还有31个中国有这么多

43
00:02:35,392 --> 00:02:36,928
而在白色的这些

44
00:02:40,256 --> 00:02:43,840
在我们计算机的这个术语里头

45
00:02:44,096 --> 00:02:47,424
往往把4K叫做一个Page

46
00:02:48,448 --> 00:02:51,008
前面还提到一个术语叫progressed

47
00:02:51,520 --> 00:02:57,408
当时是在是我我不知道回不回到前面就看了当时在谈

48
00:02:57,664 --> 00:03:01,248
你这个大小要调整到16的倍数

49
00:03:01,504 --> 00:03:03,552
16就是一个paragraph

50
00:03:04,320 --> 00:03:10,464
要翻译成什么那一段吗telegraph中文章里面的一段叫一个telegram

51
00:03:10,720 --> 00:03:13,024
那就是一个Page 4K

52
00:03:14,560 --> 00:03:16,864
所以我们这边讲所有八个Page

53
00:03:17,632 --> 00:03:19,424
这八个Page

54
00:03:20,192 --> 00:03:21,472
将会费

55
00:03:22,496 --> 00:03:28,128
为什么非sbh50在源代码里头看到它会把它变成这个样子

56
00:03:29,408 --> 00:03:30,688
这时的

57
00:03:30,944 --> 00:03:32,736
拨打大华盛行的

58
00:03:34,528 --> 00:03:35,552
才华的下去

59
00:03:36,576 --> 00:03:38,112
这8块

60
00:03:38,624 --> 00:03:40,160
都会变成

61
00:03:40,672 --> 00:03:43,744
我看这个画面比较小后面面比较大的呢

62
00:03:44,512 --> 00:03:48,352
这个就比较大了我们别在切过去现在去回到这里了

63
00:03:50,400 --> 00:03:51,936
他确实是连续的

64
00:03:52,704 --> 00:03:58,848
那么在逻辑上那我也吃了一些指针sdh不是我sdh也去色一些

65
00:03:59,104 --> 00:03:59,616
蝎子

66
00:04:00,384 --> 00:04:01,408
把它串起来

67
00:04:02,688 --> 00:04:06,272
并且设定有一些地方设定为黄色的部分

68
00:04:06,528 --> 00:04:07,552
这个词就是不一

69
00:04:08,576 --> 00:04:09,856
你就是个字

70
00:04:10,368 --> 00:04:12,928
Ffff ffff

71
00:04:13,952 --> 00:04:15,744
打电话还有一些保留

72
00:04:16,000 --> 00:04:18,047
为什么谈保留我等一下再说

73
00:04:19,071 --> 00:04:21,887
所以设成这样之后

74
00:04:25,215 --> 00:04:30,847
再用这个指针把他拉到64条链表里面的最后那一种

75
00:04:31,871 --> 00:04:34,175
最后来一条链表两个指针吗

76
00:04:35,967 --> 00:04:37,503
这样就形成了

77
00:04:38,527 --> 00:04:44,671
我们到底要什么效果呢sth到底要什么效果呢他把这

78
00:04:44,927 --> 00:04:49,023
大的区块里面挖出1/32

79
00:04:49,279 --> 00:04:50,047
1块

80
00:04:50,559 --> 00:04:54,399
再把这一块也就是这一话

81
00:04:55,935 --> 00:04:57,471
设成这个样子

82
00:04:57,983 --> 00:05:04,127
有点像是前面的儿饺子弹分配器的时候挖一大会去做

83
00:05:04,383 --> 00:05:05,919
我切歌把它串起来

84
00:05:06,687 --> 00:05:07,711
意思是一样的

85
00:05:09,247 --> 00:05:13,599
串起来之后要挂到哪一个链表去呢

86
00:05:14,111 --> 00:05:16,927
目前把它挂到最后一条链表

87
00:05:19,487 --> 00:05:23,583
这就是他目前想做的事情目前做到的事情

88
00:05:26,143 --> 00:05:28,191
看看我图上的表现

89
00:05:28,447 --> 00:05:29,983
这个骨肉分离

90
00:05:30,239 --> 00:05:32,287
我这边就等同于

91
00:05:32,543 --> 00:05:33,823
这个

92
00:05:35,359 --> 00:05:38,687
现在这个东西最后一个链表达了谁

93
00:05:40,223 --> 00:05:42,271
每一个都是一个Page

94
00:05:43,039 --> 00:05:45,087
Hhh 2x3

95
00:05:45,343 --> 00:05:47,135
每一个都是4K

96
00:05:50,207 --> 00:05:52,767
这里有64条链表这里

97
00:05:53,279 --> 00:05:59,423
你可以想象你可以开始想象这些东西就是手上的冰吗

98
00:06:00,191 --> 00:06:00,959
现在

99
00:06:01,983 --> 00:06:02,495
现在

100
00:06:02,751 --> 00:06:08,895
IPhone x的一个要吃螃蟹的人他要来我妈也会因此现在手上有

101
00:06:09,151 --> 00:06:09,919
有这些东西了

102
00:06:10,431 --> 00:06:16,063
怎么做呢一定是从这个地方发出1块给他指针给他

103
00:06:16,831 --> 00:06:21,951
把这个地址给他就相当于给出去了然后这边的指针在做一些变化

104
00:06:23,743 --> 00:06:25,279
1233的

105
00:06:26,303 --> 00:06:27,327
Excuse

106
00:06:27,839 --> 00:06:29,887
等到把这些给光了之后

107
00:06:31,423 --> 00:06:33,471
给关了之后他这个

108
00:06:33,983 --> 00:06:36,031
最后一条链表就变成空了

109
00:06:37,823 --> 00:06:41,407
下次再要的话那就要开始挖的了快

110
00:06:42,943 --> 00:06:47,807
而第2块下面这块也就应该有右边的下面这个功能

111
00:06:48,831 --> 00:06:49,599
最近

112
00:06:51,903 --> 00:06:54,975
来管理怎么管理他就是刚刚一样的事情

113
00:06:57,791 --> 00:07:00,351
说他真正分配内存这个

114
00:07:00,863 --> 00:07:03,679
Sph跟操作系统要的

115
00:07:04,447 --> 00:07:07,007
其实一开始并不是要那个

116
00:07:07,263 --> 00:07:08,799
她要的只是30

117
00:07:09,055 --> 00:07:10,591
只是这一段

118
00:07:11,871 --> 00:07:12,639
八大会

119
00:07:12,895 --> 00:07:13,919
也就是32

120
00:07:14,431 --> 00:07:14,943
嘿

121
00:07:16,479 --> 00:07:22,111
儿子你那个是什么你刚刚不是一直在谈因为搞只是一个地址空间

122
00:07:22,367 --> 00:07:24,159
是一个虚的东西

123
00:07:25,951 --> 00:07:27,231
而这一部分就是

124
00:07:27,743 --> 00:07:28,511
牵涉到

125
00:07:28,767 --> 00:07:30,559
Windows操作系统对于

126
00:07:30,815 --> 00:07:33,119
真正的内存但对于

127
00:07:33,631 --> 00:07:36,447
虚地址空间的一个话本

128
00:07:36,959 --> 00:07:37,727
我们

129
00:07:38,239 --> 00:07:39,263
不谈太多

130
00:07:39,519 --> 00:07:41,567
现在不需要你你需要一些

131
00:07:41,823 --> 00:07:42,591
基础

132
00:07:43,615 --> 00:07:46,175
让我用一个比喻希望能够让你理解

133
00:07:46,687 --> 00:07:49,503
这个地方好像是门牌号码

134
00:07:50,271 --> 00:07:52,319
你拥有音乐感

135
00:07:52,575 --> 00:07:55,647
门牌号码但是没有房子

136
00:07:56,671 --> 00:07:58,975
等到真正要的时候就先

137
00:07:59,743 --> 00:08:03,327
前埔乡大好这个房子32k

138
00:08:05,119 --> 00:08:06,399
用光的话呢

139
00:08:06,911 --> 00:08:08,191
再继续剧

140
00:08:08,703 --> 00:08:11,263
去去加个盖房子吗好像这个

141
00:08:11,775 --> 00:08:13,823
也不是太好了

142
00:08:14,335 --> 00:08:17,151
一个模拟的

143
00:08:18,175 --> 00:08:19,455
不知道该怎么说了

144
00:08:19,967 --> 00:08:24,575
你看开始的应该是一个虚的他只有号码牌子

145
00:08:25,855 --> 00:08:28,415
这个身份证就放在这里

146
00:08:30,207 --> 00:08:31,231
现在我们

147
00:08:31,487 --> 00:08:32,767
这个图放大

148
00:08:33,791 --> 00:08:34,559
看看他

149
00:08:34,815 --> 00:08:38,911
一开始把这个32k也就是这个发个配置

150
00:08:39,167 --> 00:08:43,007
是怎么切成这8块的对细部的去看看

151
00:08:49,151 --> 00:08:49,663
注意

152
00:08:49,919 --> 00:08:52,735
这8块是本来的联系在一起

153
00:08:52,991 --> 00:08:56,831
一次性地跟操作系统要过来的真正受伤的冰

154
00:08:57,855 --> 00:08:59,135
纸上谈兵那个兵

155
00:09:01,183 --> 00:09:01,695
好

156
00:09:04,255 --> 00:09:09,119
其实我们等的就是在看源代码了当我在做这些讲解就是源代码的行为

157
00:09:11,167 --> 00:09:17,311
他把每一个这个这个这样的offset这样的偏移值的地方这里社会

158
00:09:17,567 --> 00:09:19,359
51 C是负一

159
00:09:20,127 --> 00:09:22,687
继续往下侧也就是往右边塞

160
00:09:23,199 --> 00:09:24,479
这边多少米

161
00:09:25,503 --> 00:09:29,855
社会的作用的后面你才会看到我现在想提一下

162
00:09:30,623 --> 00:09:33,183
这将来他的回收的时候他要合并

163
00:09:33,951 --> 00:09:36,511
他的发挥做合并的动作

164
00:09:37,791 --> 00:09:40,351
这次合并的过程里面呢

165
00:09:40,863 --> 00:09:46,239
还要用这个符号的来作为一个篱笆一个阻隔气

166
00:09:46,751 --> 00:09:49,567
这再怎么合并这个合成现在这个样子

167
00:09:50,847 --> 00:09:54,943
这一会开会不会再合并这一会就最快也不会再合并

168
00:09:56,735 --> 00:09:59,807
现在可能对你来讲还是太抽象了

169
00:10:00,063 --> 00:10:00,831
但是这样

170
00:10:01,855 --> 00:10:03,647
这些东西吃好之后再把

171
00:10:03,903 --> 00:10:05,439
一些特定的位置

172
00:10:05,695 --> 00:10:08,511
黄色一下就是两根指针

173
00:10:09,279 --> 00:10:11,071
黄色一下有三格

174
00:10:11,839 --> 00:10:14,143
其中的两个设置增强个串起来了

175
00:10:15,423 --> 00:10:19,519
相当于我们就硬生生地把这个1把蒜切成八块

176
00:10:20,031 --> 00:10:22,079
而d1格

177
00:10:23,615 --> 00:10:24,895
记录的是

178
00:10:25,663 --> 00:10:27,199
最快的大小

179
00:10:28,479 --> 00:10:31,551
我好像有点犹豫不决我到底要比哪一会呢

180
00:10:31,807 --> 00:10:34,111
4080到底是哪一块呢

181
00:10:34,623 --> 00:10:39,999
4080就是这个两个黄色中间的一块

182
00:10:42,559 --> 00:10:44,863
这就是在拉丁裔中的一个block

183
00:10:45,119 --> 00:10:45,887
会

184
00:10:46,143 --> 00:10:50,751
一个内存块这块将来要切不变的更小越欠越小

185
00:10:51,007 --> 00:10:54,847
吃过刀削面把那个消消乐牵手上的那个萝卜

186
00:10:55,103 --> 00:10:57,407
不是萝卜白团队越来越小

187
00:10:57,663 --> 00:10:59,199
一道味道的销售区

188
00:11:00,479 --> 00:11:02,015
但他目前是多少

189
00:11:03,551 --> 00:11:05,343
这个是4096

190
00:11:06,367 --> 00:11:07,903
这大概是4096

191
00:11:08,671 --> 00:11:10,719
扣掉这个两个黄色的

192
00:11:11,487 --> 00:11:12,511
口*吧

193
00:11:13,023 --> 00:11:15,583
4096扣料吧

194
00:11:16,863 --> 00:11:20,703
突然4096号条84088

195
00:11:22,239 --> 00:11:25,055
最黄色中间夹的是4088

196
00:11:27,103 --> 00:11:28,127
暗示

197
00:11:28,383 --> 00:11:33,247
他自己就跟自己规定说我的每一个部落格都是16的倍数

198
00:11:34,783 --> 00:11:37,343
4088不是16的倍数

199
00:11:39,647 --> 00:11:40,415
所以

200
00:11:40,927 --> 00:11:41,951
再调整一下

201
00:11:42,463 --> 00:11:45,791
什么都在调整啊他把这个地方当成保留

202
00:11:47,071 --> 00:11:48,607
说保留是好听

203
00:11:48,863 --> 00:11:50,143
南京就是浪费

204
00:11:50,911 --> 00:11:54,751
因为刚刚4.88不是19的倍数所以只好把自己的说小一点

205
00:11:55,007 --> 00:11:56,287
4080

206
00:11:56,799 --> 00:12:00,127
真正可用的只是08年

207
00:12:01,663 --> 00:12:02,431
下面

208
00:12:02,687 --> 00:12:04,223
那么这一块

209
00:12:04,479 --> 00:12:07,039
一个block在整个系统里面的

210
00:12:07,295 --> 00:12:08,831
任何的blog

211
00:12:09,087 --> 00:12:10,623
都要带着上下工具

212
00:12:11,135 --> 00:12:13,439
他要自己记住自己有多大

213
00:12:14,975 --> 00:12:20,351
所以这一块可以到这里的黄色厢卡的这个上下都有

214
00:12:20,607 --> 00:12:22,399
4080

215
00:12:23,167 --> 00:12:25,471
进入了纪录着他自己的大小

216
00:12:28,031 --> 00:12:34,175
因此就多出了刚刚4.88吗现在变4080多出了八个呗这是没有用

217
00:12:36,735 --> 00:12:38,015
在这里加保留

218
00:12:40,063 --> 00:12:42,879
对每一个4K全部都这样处理

219
00:12:43,391 --> 00:12:45,183
形成了现在这个图

220
00:12:48,511 --> 00:12:50,047
然后就8块

221
00:12:51,327 --> 00:12:52,863
被恋到最后一

222
00:12:53,631 --> 00:12:55,167
最后一个

223
00:12:55,679 --> 00:12:56,703
乔链表去

224
00:12:59,263 --> 00:13:04,639
这里每一个东西每一组链表一队

225
00:13:04,895 --> 00:13:05,663
两根

226
00:13:06,175 --> 00:13:07,199
是什么呢

227
00:13:07,711 --> 00:13:08,991
好的源代码

228
00:13:09,247 --> 00:13:10,527
数据结构在这里

229
00:13:12,575 --> 00:13:13,599
我们往前看

230
00:13:14,879 --> 00:13:16,159
我不再看这个

231
00:13:16,671 --> 00:13:17,951
现在回到前头

232
00:13:21,023 --> 00:13:22,047
没有数据结构

233
00:13:24,607 --> 00:13:25,631
打开已经看过了

234
00:13:27,423 --> 00:13:30,239
一个group好早出国如果在这里

235
00:13:32,031 --> 00:13:34,591
他有64个

236
00:13:34,847 --> 00:13:36,127
这种this test

237
00:13:36,895 --> 00:13:39,711
64个这个

238
00:13:42,271 --> 00:13:44,319
现在我们来看看这是什么

239
00:13:46,879 --> 00:13:50,719
我还不是这个entry已经出现了

240
00:13:51,231 --> 00:13:52,511
Mr have下面示例

241
00:13:53,023 --> 00:13:56,095
在64个点

242
00:13:58,143 --> 00:14:02,239
它是两根指针每根指针指向一个entry

243
00:14:03,775 --> 00:14:06,335
所以我们现在去看看entry是什么

244
00:14:08,895 --> 00:14:10,943
里头又是两根指针

245
00:14:11,967 --> 00:14:14,527
指的是自己的东西

246
00:14:16,319 --> 00:14:18,367
那只要注意这边有一个总数

247
00:14:21,695 --> 00:14:23,487
华盛顿就是这样啊

248
00:14:25,535 --> 00:14:31,167
如果你很细心并且你刚刚已经注意到你可能会想老师你是不是画错了呢

249
00:14:31,679 --> 00:14:33,215
这点跟指针

250
00:14:33,471 --> 00:14:35,519
我怎么都是网上话

251
00:14:35,775 --> 00:14:38,847
这两根指针都是网上网

252
00:14:39,615 --> 00:14:41,151
就为了呼应这一个

253
00:14:42,431 --> 00:14:44,735
这是他10座上的一个小细节

254
00:14:45,759 --> 00:14:46,271
就是

255
00:14:46,527 --> 00:14:50,111
这个指针指出去指的是三个东西

256
00:14:51,903 --> 00:14:53,439
可是他自己其实是

257
00:14:54,207 --> 00:14:55,999
只有64对指针

258
00:14:56,511 --> 00:15:00,351
所以在搁这个整数是借用上面的人

259
00:15:00,863 --> 00:15:01,887
解一下

260
00:15:03,423 --> 00:15:04,703
在这个例子看

261
00:15:04,959 --> 00:15:05,727
家用

262
00:15:06,495 --> 00:15:08,031
不会带来坏的影响

263
00:15:10,335 --> 00:15:11,359
到了这边来

264
00:15:13,407 --> 00:15:18,527
说我这个最后一条双向链表的指针是只有两根

265
00:15:19,039 --> 00:15:21,855
可是这个只是过来之后

266
00:15:22,879 --> 00:15:24,159
指的是3格

267
00:15:25,439 --> 00:15:28,767
再次过来那三格栅格栅格栅格栅格

268
00:15:29,023 --> 00:15:30,815
在此回去

269
00:15:31,839 --> 00:15:33,887
注意到上面这里来了

270
00:15:34,399 --> 00:15:35,935
台湾从这里出发的

271
00:15:36,959 --> 00:15:40,799
现在只回来是知道上面这里借用了上

272
00:15:41,311 --> 00:15:42,335
面的哪一个

273
00:15:44,127 --> 00:15:45,151
这个不影响

274
00:15:45,663 --> 00:15:46,943
因为不可能去

275
00:15:47,199 --> 00:15:52,831
这个代码的这个设计者他不会去改动上面这一个内容不会去破坏别人

276
00:15:53,599 --> 00:15:55,391
所以只是借用一下

277
00:15:56,927 --> 00:16:02,303
是一个很小的10座上的小细节其实也没什么多少内存

278
00:16:03,071 --> 00:16:06,911
说起来有点危险而是写的人的很很有自信

279
00:16:12,799 --> 00:16:13,567
所以

280
00:16:14,591 --> 00:16:15,615
来到前面来

281
00:16:18,431 --> 00:16:21,503
为了应付的一块内存的需求

282
00:16:21,759 --> 00:16:23,807
手上有这些冰

283
00:16:25,087 --> 00:16:31,231
要开始到消灭要切一切出去的时候之前先把他在做一个整

284
00:16:31,487 --> 00:16:33,535
整理整理成这样发大会

285
00:16:33,791 --> 00:16:34,815
串起来

286
00:16:35,071 --> 00:16:37,631
交由最后一个电表的串起来

287
00:16:39,679 --> 00:16:41,983
接下去就要敲第1套了

288
00:16:47,615 --> 00:16:48,383
这个就是

289
00:16:48,895 --> 00:16:50,431
一个切割的动作

290
00:16:50,943 --> 00:16:52,991
我们接下去就要详细的讲

291
00:16:53,247 --> 00:16:55,295
这里面的数字的变化
